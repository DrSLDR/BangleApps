function calcWeekNo(e){var t=new Date(e-60*e.getTimezoneOffset()*1e3),a=new Date(t.getFullYear(),t.getMonth(),t.getDate());a.setDate(a.getDate()+4-(a.getDay()||7));var o=new Date(a.getFullYear(),0,1);return Math.ceil(((a-o)/864e5+1)/7)}function renderPercent(e){var t=(e=(e/10).toFixed(1)).toString().padStart(4,0)+"%";return 100==e&&(t="100 %"),t}function drawSlowClock(e){var t=e.getHours(),a=e.getMinutes(),o=t.toString().padStart(2,0)+":"+a.toString().padStart(2,0);drawComponent({main:o},slowClockCfg)}function drawFastClock(e){var t=e.getSeconds().toString().padStart(2,0);drawComponent({main:t},fastClockCfg)}function drawISO8601(e){var t=e.getFullYear(),a=e.getMonth()+1,o=e.getDate(),n=t.toString()+"-"+a.toString().padStart(2,0)+"-"+o.toString().padStart(2,0);drawComponent({main:n},iso8601Cfg)}function drawTimestamp(e){var t=Math.floor(e.getTime()/1e3).toString();drawComponent({main:t},timestampCfg)}function drawTZ(e){var t=e.toString().split(" ").reverse()[0].replace("GMT","UTC");drawComponent({main:t},timezoneCfg)}function drawDateInfoLine(e){var t=e.toString().split(" ")[0].toUpperCase(),a=new Date(e.getFullYear(),e.getMonth()+1,0).getDate(),o=calcWeekNo(e).toString().padStart(2,0);drawComponent({dH:dateInfoCfg.element.dH.template,d:t,mdH:dateInfoCfg.element.mdH.template,md:a,wH:dateInfoCfg.element.wH.template,w:o},dateInfoCfg)}function drawPercentLine(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0),a=renderPercent(Math.floor((e-t)/86400)),o=new Date(e.getFullYear(),0,1),n=new Date(e.getFullYear(),11,31,23,59,59,999)-o,l=renderPercent(Math.floor(1e3*(e-o)/n));drawComponent({pOfDH:pLineCfg.element.pOfDH.template,pOfD:a,pOfYH:pLineCfg.element.pOfYH.template,pOfY:l},pLineCfg)}function drawHealth(){var e=Math.round(Bangle.getHealthStatus().bpm||Bangle.getHealthStatus("last").bpm);e=e.toString().padStart(3,0);var t=Math.round(Bangle.getHealthStatus().steps||Bangle.getHealthStatus("last").steps);t=t.toString().padStart(5,0),drawComponent({hrH:healthCfg.element.hrH.template,hr:e,
stepH:healthCfg.element.stepH.template,step:t},healthCfg)}function drawDeviceStatus(){var e=(E.getBattery()+"%").padStart(4," "),t=NRF.getSecurityStatus().connected?" ":deviceStatusCfg.element.con.template;drawComponent({con:t,bat:e},deviceStatusCfg)}function drawWeather(){var e;try{e=storage.readJSON("weather.json").weather}catch(e){return}var t,a=e.temp,o=Math.round(a-273.15),n=(t="",t+=o<0?"-":" ",t+=Math.abs(o).toString().padStart(2,0),t+="C["+a+"]"),l=(1609.344*e.wind/3600).toFixed(1),r=e.wdir,i=["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW","N"][Math.floor((r+11.25)/22.5)],s=l.padStart(4,0)+"["+i+"]",f=e.hum.toString().padStart(2,0).padStart(3," ")+"%";drawComponent({tH:weatherConf.element.tH.template,t:n,wH:weatherConf.element.wH.template,w:s,hH:weatherConf.element.hH.template,h:f},weatherConf)}function drawMoon(e){var t=(e.getTime()-knownNew.getTime())/6e4/lunation%1,a=(-1*Math.cos(t*Math.PI*2)+1)/2,o="NEW";t>.025&&t<.225||t>.275&&t<.475?o="WAX":t>=.225&&t<=.275?o="Q:1":t>=.475&&t<=.525?o=" F ":t>.525&&t<.725||t>.775&&t<.975?o="WAN":t>=.725&&t<=.775&&(o="Q:3");var n=renderPercent(Math.round(1e3*a))+"["+o+"]";drawComponent({moonH:moonCfg.element.moonH.template,moon:n},moonCfg)}function drawFast(e){drawFastClock(e),drawTimestamp(e)}function drawSlow(e){drawSlowClock(e),drawISO8601(e),drawTZ(e),drawDateInfoLine(e),drawPercentLine(e),drawHealth(),drawDeviceStatus(),drawWeather(),drawMoon(e)}function drawLoop(){var e=new Date,t=e.getMinutes();t!=minute&&(minute=t,drawSlow(e)),drawFast(e)}function drawAll(){var e=new Date;drawSlow(e),drawFast(e)}const storage=require("Storage");require("Font7x11Numeric7Seg").add(Graphics),require("Font5x7Numeric7Seg").add(Graphics);const lunation=42524,knownNew=new Date("2022-01-02T19:33:00"),dmax=176,padding=4,slowClockCfg={element:{main:{font:"7x11Numeric7Seg",scale:3,template:"00:00"}}},fastClockCfg={element:{main:{font:"7x11Numeric7Seg",scale:2,template:"00"}}},iso8601Cfg={element:{main:{font:"5x7Numeric7Seg",scale:2,
template:"0000-00-00"}}},timestampCfg={element:{main:{font:"7x11Numeric7Seg",scale:1,template:"0000000000"}}},timezoneCfg={element:{main:{font:"6x8",scale:1,template:"UTC+0000"}}},pLineCfg={element:{pOfDH:{font:"4x6",scale:1,template:"POD:"},pOfD:{font:"6x8",scale:1,template:"00.0%",xNudge:-4},pOfYH:{font:"4x6",scale:1,template:"POY:"},pOfY:{font:"6x8",scale:1,template:"00.0%",xNudge:-4}}},dateInfoCfg={element:{dH:{font:"4x6",scale:1,template:"D:"},d:{font:"6x8",scale:1,template:"MON",xNudge:-4},mdH:{font:"4x6",scale:1,template:"MD:"},md:{font:"6x8",scale:1,template:"31",xNudge:-4},wH:{font:"4x6",scale:1,template:"W:"},w:{font:"6x8",scale:1,template:"00",xNudge:-4}}},healthCfg={element:{hrH:{font:"4x6",scale:1,template:"HR:"},hr:{font:"6x8",scale:1,template:"000",xNudge:-4},stepH:{font:"4x6",scale:1,template:"S:"},step:{font:"6x8",scale:1,template:"00000",xNudge:-4}}},deviceStatusCfg={element:{con:{font:"6x8",scale:1,template:"*"},bat:{font:"6x8",scale:1,template:"000%"}}},weatherConf={element:{tH:{font:"4x6",scale:1,template:"T:"},t:{font:"6x8",scale:1,template:"-00C(000)",xNudge:-4},wH:{font:"4x6",scale:1,template:"W:"},w:{font:"6x8",scale:1,template:"00.0[XXX]",xNudge:-4},hH:{font:"4x6",scale:1,template:"H:"},h:{font:"6x8",scale:1,template:"000%",xNudge:-4}}},moonCfg={element:{moonH:{font:"4x6",scale:1,template:"M:"},moon:{font:"6x8",scale:1,template:"00.0%[XXX]",xNudge:-4}}};var deriveAllXSizes=function(e){var t=0,a=0,o=0;for(var n of Object.keys(e.element)){g.setFont(e.element[n].font,e.element[n].scale);var l=g.stringWidth(e.element[n].template),r=g.getFontHeight();t+=l,e.element[n].xNudge&&(t+=e.element[n].xNudge),r>a&&(a=r),o+=1,e.element[n].size={x:l,y:r}}t+=4*(o-1),e.size={x:t,y:a}};deriveAllXSizes(slowClockCfg),deriveAllXSizes(fastClockCfg),deriveAllXSizes(iso8601Cfg),deriveAllXSizes(timestampCfg),deriveAllXSizes(timezoneCfg),deriveAllXSizes(pLineCfg),deriveAllXSizes(dateInfoCfg),deriveAllXSizes(healthCfg),deriveAllXSizes(deviceStatusCfg),deriveAllXSizes(weatherConf),deriveAllXSizes(moonCfg),
slowClockCfg.pos={x:(176-slowClockCfg.size.x-fastClockCfg.size.x)/2,y:(176-slowClockCfg.size.y)/2},fastClockCfg.pos={x:slowClockCfg.pos.x+slowClockCfg.size.x,y:slowClockCfg.pos.y+slowClockCfg.size.y-fastClockCfg.size.y},iso8601Cfg.pos={x:(176-iso8601Cfg.size.x)/2,y:slowClockCfg.pos.y-4-iso8601Cfg.size.y},timestampCfg.pos={x:(176-timestampCfg.size.x)/2,y:slowClockCfg.pos.y+slowClockCfg.size.y+4},timezoneCfg.pos={x:(176-timezoneCfg.size.x)/2,y:172-timezoneCfg.size.y},pLineCfg.pos={x:(176-pLineCfg.size.x)/2,y:timezoneCfg.pos.y-4-pLineCfg.size.y},dateInfoCfg.pos={x:(176-dateInfoCfg.size.x)/2,y:pLineCfg.pos.y-4-dateInfoCfg.size.y},healthCfg.pos={x:4,y:4},deviceStatusCfg.pos={x:172-deviceStatusCfg.size.x,y:4},weatherConf.pos={x:(176-weatherConf.size.x)/2,y:deviceStatusCfg.pos.y+deviceStatusCfg.size.y+4},moonCfg.pos={x:(176-moonCfg.size.x)/2,y:weatherConf.pos.y+weatherConf.size.y+4};var deriveAllPositions=function(e){var t=e.pos.x,a=0;for(var o of Object.keys(e.element)){a>0&&(t+=4);var n=e.pos.y;e.element[o].size.y<e.size.y&&(n+=e.size.y-e.element[o].size.y),e.element[o].xNudge&&(t+=e.element[o].xNudge),e.element[o].pos={x:t,y:n},t+=e.element[o].size.x,a+=1}};deriveAllPositions(slowClockCfg),deriveAllPositions(fastClockCfg),deriveAllPositions(iso8601Cfg),deriveAllPositions(timestampCfg),deriveAllPositions(timezoneCfg),deriveAllPositions(pLineCfg),deriveAllPositions(dateInfoCfg),deriveAllPositions(healthCfg),deriveAllPositions(deviceStatusCfg),deriveAllPositions(weatherConf),deriveAllPositions(moonCfg);var minute=0,drawString=function(e,t){g.reset(),g.setFont(t.font,t.scale),g.drawString(e,t.pos.x,t.pos.y,!0)},drawComponent=function(e,t){for(var a of Object.keys(t.element))drawString(e[a],t.element[a])};g.clear();var timer=setInterval(drawLoop,500);Bangle.on("lcdPower",e=>{timer&&(clearInterval(timer),timer=void 0),e&&(timer=setInterval(drawLoop,500),drawAll())}),Bangle.setUI("clock"),drawAll();